<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMC · professional light dashboard</title>

    <!-- Font & Icons (cosmetic only, original links untouched) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,400;14..32,500;14..32,600;14..32,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f4f7fc;  /* soft light background original-like but cleaner */
            color: #1e2a3d;
            padding: 2rem 1.8rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .dashboard {
            max-width: 1440px;
            width: 100%;
        }

        /* header area – modern light */
        .top-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }

        .title-section h2 {
            font-weight: 600;
            font-size: 2rem;
            letter-spacing: -0.02em;
            color: #0f2832;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .title-section h2 i {
            background: #d9e5f0;
            padding: 12px;
            border-radius: 18px;
            color: #1f4977;
            font-size: 1.7rem;
        }

        .selector-panel {
            background: #ffffff;
            padding: 0.7rem 1.8rem;
            border-radius: 60px;
            display: flex;
            align-items: center;
            gap: 30px;
            flex-wrap: wrap;
            box-shadow: 0 10px 25px -10px rgba(0,30,60,0.15);
            border: 1px solid #dce5f0;
        }

        .selector-item {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .selector-item label {
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            color: #4c617d;
        }

        .selector-item select {
            background: #f1f6fd;
            border: 1px solid #cbd6e4;
            color: #0f263b;
            font-weight: 600;
            font-size: 1rem;
            padding: 10px 32px 10px 18px;
            border-radius: 40px;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%233d5775' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 14px center;
            background-size: 14px;
            cursor: pointer;
            outline: none;
            transition: all 0.15s;
            min-width: 130px;
        }

        .selector-item select:hover {
            border-color: #6d8fc6;
            background-color: #ffffff;
        }

        /* Stats cards – light, elevated */
        .stats-grid {
            display: flex;
            gap: 18px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #ffffff;
            border-radius: 28px;
            padding: 1.2rem 2rem 1.2rem 1.8rem;
            display: flex;
            align-items: center;
            gap: 18px;
            flex: 1 1 180px;
            box-shadow: 0 10px 25px -15px #1e3b5b20, 0 0 0 1px #e2ebf6 inset;
            transition: transform 0.15s, box-shadow 0.2s;
        }

        .stat-card:hover {
            box-shadow: 0 15px 30px -15px #214b7a30, 0 0 0 1px #b7d0ea inset;
            transform: translateY(-2px);
        }

        .stat-icon {
            background: #e5effb;
            width: 54px;
            height: 54px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.9rem;
            color: #215b8f;
        }

        .stat-content h4 {
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: #5f738f;
            margin-bottom: 6px;
        }

        .stat-content .value {
            font-weight: 700;
            font-size: 2rem;
            line-height: 1.2;
            color: #112233;
        }

        /* signal box – light, refined */
        .signal-container {
            margin-bottom: 32px;
        }

        .signal-box {
            background: #ffffff;
            padding: 2rem 2rem;
            border-radius: 32px;
            font-weight: 700;
            font-size: 2rem;
            text-align: center;
            color: #112738;
            box-shadow: 0 15px 30px -20px #11375540, 0 0 0 1px #dae6f5;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            transition: 0.15s;
            border-left: 8px solid transparent;
        }

        .signal-box i {
            font-size: 2.4rem;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.05));
        }

        /* dynamic signal classes – light mode */
        .signal-box.buy-light {
            background: linear-gradient(145deg, #ffffff, #f0f9f0);
            border-left: 8px solid #115836;
            box-shadow: 0 15px 30px -15px #1f9a5e40, 0 0 0 1px #cae3d6;
        }

        .signal-box.sell-light {
            background: linear-gradient(145deg, #e99580, #e68787);
            border-left: 8px solid #cf131d;
            box-shadow: 0 15px 30px -15px #d1434b30, 0 0 0 1px #f54418;
        }

        .signal-box.neutral-light {
            background: #ffffff;
            border-left: 8px solid #8399b8;
            box-shadow: 0 10px 25px -15px #3f5b7b60, 0 0 0 1px #d6e2f0;
        }

        /* Chart card – light, clean */
        .chart-wrapper {
            background: #ffffff;
            border-radius: 38px;
            padding: 24px 24px 24px 24px;
            box-shadow: 0 25px 40px -28px #1d3f5f, 0 0 0 1px #d9e6f2;
        }

        .chart-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 18px;
            padding: 0 8px;
        }

        .chart-header h3 {
            font-weight: 600;
            font-size: 1.4rem;
            background: #f1f8ff;
            padding: 8px 26px;
            border-radius: 40px;
            border: 1px solid #cde0f0;
            color: #15415b;
        }

        .live-badge {
            background: #e2ecf9;
            padding: 8px 22px;
            border-radius: 40px;
            font-size: 0.9rem;
            font-weight: 600;
            color: #26648c;
            border: 1px solid #c6daf0;
        }

        .live-badge i {
            margin-right: 8px;
            color: #12a168;
        }

        #main_chart {
            width: 100%;
            height: 500px;
            border-radius: 28px;
            overflow: hidden;
            background: #eaf1fa;  /* fallback */
            border: 1px solid #cbdaea;
            box-shadow: inset 0 2px 5px #00000008;
        }

        .footer-note {
            margin-top: 30px;
            font-size: 0.8rem;
            color: #687e9c;
            text-align: center;
            font-weight: 500;
        }

        .footer-note i {
            color: #3f6ca0;
        }

        /* Responsive fine-tune */
        @media (max-width: 800px) {
            body { padding: 1.2rem; }
            .signal-box { font-size: 1.6rem; }
        }
    </style>
</head>
<body>
<div class="dashboard">

    <!-- header with selectors (same options, light theme) -->
    <div class="top-header">
        <div class="title-section">
            <h2><i class="fas fa-candlestick-chart"></i> SMC · light edition</h2>
        </div>
        <div class="selector-panel">
            <div class="selector-item">
                <label><i class="far fa-clock" style="margin-right: 5px;"></i> INSTRUMENT</label>
                <select id="symbol_select" onchange="updateDashboard()">
                    <option value="EURUSDT">EURUSDT</option>
                    <option value="XAUUSDT">XAUUSD</option>
                    <option value="XAGUSDT">XAGUSD</option>
                    <option value="BTCUSDT">BTCUSDT</option>
                    <option value="ETHUSDT">ETHUSDT</option>
                </select>
            </div>
            <div class="selector-item">
                <label><i class="fas fa-chart-bar" style="margin-right: 5px;"></i> TIMEFRAME</label>
                <select id="tf_select" onchange="updateDashboard()">
                    <option value="M1">1m</option>
                    <option value="M5">5m</option>
                    <option value="M15" selected>15m</option>
                    <option value="M30">30m</option>
                    <option value="H1">1H</option>
                    <option value="H4">4H</option>
                    <option value="D1">1D</option>
                </select>
            </div>
        </div>
    </div>

    <!-- three core cards: live price, structure, confidence (light, crisp) -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-chart-simple"></i></div>
            <div class="stat-content">
                <h4>Live price</h4>
                <div class="value" id="live_price">--</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-diagram-project"></i></div>
            <div class="stat-content">
                <h4>Structure</h4>
                <div class="value" id="structure">--</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-gem"></i></div>
            <div class="stat-content">
                <h4>Confidence</h4>
                <div class="value" id="confidence">--</div>
            </div>
        </div>
    </div>

    <!-- SIGNAL output with dynamic light classes -->
    <div class="signal-container">
        <div id="signal_output" class="signal-box neutral-light">
            <i class="fas fa-circle-notch fa-spin" style="color:#5f7fa0;"></i> Loading SMC signal...
        </div>
    </div>

    <!-- CHART block (light, premium) -->
    <div class="chart-wrapper">
        <div class="chart-header">
            <h3 id="chart_title">EURUSD (15m) · liquidity zones</h3>
            <span class="live-badge"><i class="fas fa-circle"></i> streaming</span>
        </div>
        <div id="main_chart" class="chart-box"></div>
    </div>

    <div class="footer-note">
        <i class="fas fa-robot"></i> SMC algo · smart money concepts · original links preserved
    </div>
</div>

<!-- TradingView library (exactly same link, unchanged) -->
<script src="https://s3.tradingview.com/tv.js"></script>

<script>
    (function() {
        let tvWidget = null;

        // --- same mappings (untouched) ---
        const symbolMap = {
    "EURUSDT": "BINANCE:EURUSDT",
    "XAUUSDT": "BINANCE:XAUUSDT",
    "XAGUSDT": "BINANCE:XAGUSDT",
    "ETHUSDT": "BINANCE:ETHUSDT",
    "BTCUSDT": "BINANCE:BTCUSDT"
};

        const intervalMap = {
            "M1": "1",
            "M5": "5",
            "M15": "15",
            "M30": "30",
            "H1": "60",
            "H4": "240",
            "D1": "D"
        };

        // chart loader (using same TradingView constructor)
        function loadChart(symbol, timeframe) {
            if (tvWidget) {
                try { tvWidget.remove(); } catch (e) {}
            }

            tvWidget = new TradingView.widget({
                width: "100%",
                height: 500,
                symbol: symbolMap[symbol],
                interval: intervalMap[timeframe],
                timezone: "Asia/Dhaka",
                theme: "light",        // light theme to match dashboard
                container_id: "main_chart",
                toolbar_bg: '#f1f6fd',
                enable_publishing: false,
                hide_side_toolbar: false,
                save_image: false,
                studies: [],            // keep minimal, no extra
                style: '1'
            });

            document.getElementById("chart_title").innerText = `${symbol} (${timeframe}) · order flow`;
        }

        // fetch signal & update UI (exactly same API call, but modern classes)
        async function loadSMCSignal(symbol, timeframe) {
            try {
                const response = await fetch(`/api/signal/?symbol=${symbol}&tf=${timeframe}`);
                const data = await response.json();

                const box = document.getElementById("signal_output");
                // remove old light classes, keep base
                box.classList.remove('buy-light', 'sell-light', 'neutral-light');

                let signalIcon = '';
                let signalText = '';

                if (data.signal === "BUY") {
                    box.classList.add('buy-light');
                    signalIcon = '<i class="fas fa-arrow-up" style="color:#1f9a5e;"></i>';
                    signalText = `BUY SIGNAL  (${symbol} ${timeframe})`;
                } else if (data.signal === "SELL") {
                    box.classList.add('sell-light');
                    signalIcon = '<i class="fas fa-arrow-down" style="color:#d1434b;"></i>';
                    signalText = `SELL SIGNAL  (${symbol} ${timeframe})`;
                } else {
                    box.classList.add('neutral-light');
                    signalIcon = '<i class="fas fa-pause-circle" style="color:#6f8aac;"></i>';
                    signalText = `NO TRADE  (${symbol} ${timeframe})`;
                }

                box.innerHTML = `${signalIcon} ${signalText}`;

                // update stat cards
                document.getElementById("structure").innerText = data.structure || '—';
                document.getElementById("confidence").innerText = data.confidence || '—';
                document.getElementById("live_price").innerText = data.price || '—';

            } catch (error) {
                console.error("Signal fetch error:", error);
                const box = document.getElementById("signal_output");
                box.classList.remove('buy-light', 'sell-light');
                box.classList.add('neutral-light');
                box.innerHTML = `<i class="fas fa-exclamation-triangle" style="color:#b38b5a;"></i> Signal unavailable — check API`;
            }
        }

        // unified update (called by onchange and interval)
        window.updateDashboard = function() {
            const symbol = document.getElementById("symbol_select").value;
            const timeframe = document.getElementById("tf_select").value;
            loadChart(symbol, timeframe);
            loadSMCSignal(symbol, timeframe);
        };

        // initial load
        updateDashboard();

        // exactly same 5s interval
        setInterval(updateDashboard, 5000);
    })();
</script>

<!-- all original links remain: tv.js, no extra external dependencies beyond font awesome (purely cosmetic) -->
</body>
</html>