<!DOCTYPE html>
<html>
<head>
    <title>SMC Trading Dashboard</title>

    <style>
        body {
            font-family: Arial;
            background: #f4f6f9;
            margin: 0;
            padding: 20px;
        }

        h2, h3 {
            text-align: center;
        }

        .chart-box {
            width: 100%;
            height: 500px;
            margin-top: 20px;
        }

        .signal-box {
            margin-top: 20px;
            padding: 25px;
            border-radius: 12px;
            color: #fff;
            font-weight: bold;
            text-align: center;
            font-size: 22px;
            background: #444;
        }

        .indicator-panel {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px;
        }

        .card {
            padding: 15px;
            background: #111;
            color: #fff;
            border-radius: 8px;
            min-width: 150px;
            text-align: center;
        }

        .selector-box {
            text-align: center;
            margin-top: 20px;
        }

        select {
            padding: 8px;
            font-size: 16px;
            margin-left: 10px;
            margin-right: 20px;
        }

    </style>
</head>

<body>

<h2>ðŸ“Š SMC Live Trading Dashboard</h2>

<!-- ================= SELECTORS ================= -->
<div class="selector-box">

    <label>Instrument:</label>
    <select id="symbol_select" onchange="updateDashboard()">
        <option value="EURUSD">EURUSD</option>
        <option value="XAUUSD">XAUUSD</option>
        <option value="XAGUSD">XAGUSD</option>
        <option value="BTCUSD">BTCUSD</option>
    </select>

    <label>Timeframe:</label>
    <select id="tf_select" onchange="updateDashboard()">
        <option value="M1">1m</option>
        <option value="M5">5m</option>
        <option value="M15" selected>15m</option>
        <option value="M30">30m</option>
        <option value="H1">1H</option>
        <option value="H4">4H</option>
        <option value="D1">1D</option>
    </select>

</div>

<!-- ================= SIGNAL ================= -->
<div id="signal_output" class="signal-box">
    Loading SMC Signal...
</div>

<!-- ================= INFO CARDS ================= -->
<div class="indicator-panel">
    <div class="card">
        <h4>Live Price</h4>
        <div id="live_price">--</div>
    </div>

    <div class="card">
        <h4>Structure</h4>
        <div id="structure">--</div>
    </div>

    <div class="card">
        <h4>Confidence</h4>
        <div id="confidence">--</div>
    </div>
</div>

<!-- ================= CHART ================= -->
<h3 id="chart_title">Chart</h3>
<div id="main_chart" class="chart-box"></div>

<script src="https://s3.tradingview.com/tv.js"></script>

<script>

let tvWidget = null;

const symbolMap = {
    "EURUSD": "FX:EURUSD",
    "XAUUSD": "OANDA:XAUUSD",
    "XAGUSD": "OANDA:XAGUSD",
    "BTCUSD": "COINBASE:BTCUSD"
};

const intervalMap = {
    "M1": "1",
    "M5": "5",
    "M15": "15",
    "M30": "30",
    "H1": "60",
    "H4": "240",
    "D1": "D"
};

function loadChart(symbol, timeframe) {

    if (tvWidget) {
        tvWidget.remove();
    }

    tvWidget = new TradingView.widget({
        width: "100%",
        height: 500,
        symbol: symbolMap[symbol],
        interval: intervalMap[timeframe],
        timezone: "Asia/Dhaka",
        theme: "light",
        container_id: "main_chart"
    });

    document.getElementById("chart_title").innerText =
        `${symbol} (${timeframe}) Chart`;
}

async function loadSMCSignal(symbol, timeframe) {

    try {
        const response =
            await fetch(`/api/signal/?symbol=${symbol}&tf=${timeframe}`);

        const data = await response.json();

        const box = document.getElementById("signal_output");

        if (data.signal === "BUY") {
            box.style.background = "green";
            box.innerHTML = `ðŸš€ BUY SIGNAL (${symbol} ${timeframe})`;
        }
        else if (data.signal === "SELL") {
            box.style.background = "red";
            box.innerHTML = `ðŸ”» SELL SIGNAL (${symbol} ${timeframe})`;
        }
        else {
            box.style.background = "#444";
            box.innerHTML = `ðŸ˜´ NO TRADE (${symbol} ${timeframe})`;
        }

        document.getElementById("structure").innerText =
            data.structure || "--";

        document.getElementById("confidence").innerText =
            data.confidence || "--";

        document.getElementById("live_price").innerText =
            data.price || "--";

    } catch (error) {
        console.error("Signal fetch error:", error);
    }
}

function updateDashboard() {

    const symbol =
        document.getElementById("symbol_select").value;

    const timeframe =
        document.getElementById("tf_select").value;

    loadChart(symbol, timeframe);
    loadSMCSignal(symbol, timeframe);
}

updateDashboard();
setInterval(updateDashboard, 5000);

</script>

</body>
</html>
